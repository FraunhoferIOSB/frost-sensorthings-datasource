{"version":3,"sources":["../src/query_ctrl.js"],"names":["QueryCtrl","appEvents","AlertSrv","GenericDatasourceQueryCtrl","$scope","$injector","alertSrv","scope","notificationShowTime","target","panelType","ctrl","panel","type","queryTypes","queryThingOptions","selectedThingOption","selectedLimit","selectedDatastreamId","selectedDatastreamName","selectedDatastreamDirty","selectedDatastreamObservationType","allDataSources","selectedSensorId","selectedSensorName","selectedSensorDirty","allSensors","selectedThingId","selectedThingName","selectedThingDirty","allThings","selectedLocationId","selectedLocationName","selectedLocationDirty","allLocations","panelCtrl","events","on","onDataReceived","bind","onDataError","jsonQuery","set","dataList","lastQueryError","err","handleQueryCtrlError","query","refId","error","data","message","rawQuery","isOmObservationType","self","datasource","metricFindQuery","then","result","catch","sensor","_","find","console","log","text","resetDataSource","targetUrl","value","getFormatedId","id","Number","isInteger","isNaN","datastream","toLowerCase","refresh","isEmpty","includes","thing","location","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!';\n\nimport { appEvents} from 'app/core/core';\nimport { AlertSrv} from 'app/core/core';\n\nexport class GenericDatasourceQueryCtrl extends QueryCtrl {\n\n    constructor($scope, $injector,alertSrv)  {\n\n        super($scope, $injector);\n\n        this.scope = $scope;\n        this.alertSrv = alertSrv;\n        this.notificationShowTime = 5000;\n\n        this.target.panelType = this.scope.ctrl.panel.type;\n\n        this.queryTypes = ['Sensors', 'Things','Locations'];\n        this.queryThingOptions = ['Datastreams', \"Historical Locations\", \"Historical Locations with Coordinates\"];\n\n        this.target.type = this.target.type || this.queryTypes[0]; // rename to selectedType?\n        this.target.selectedThingOption = this.target.selectedThingOption || this.queryThingOptions[0];\n\n        if(typeof(this.target.selectedLimit) == \"undefined\") {\n          this.target.selectedLimit = 1;\n        }\n\n        // datastream init\n        this.target.selectedDatastreamId = this.target.selectedDatastreamId || 0;\n        this.target.selectedDatastreamName = this.target.selectedDatastreamName || 'select a datastream';\n        this.target.selectedDatastreamDirty = this.target.selectedDatastreamDirty || false;\n        this.target.selectedDatastreamObservationType = this.target.selectedDatastreamObservationType || '';\n        this.allDataSources  = {};\n        // sensor init\n        this.target.selectedSensorId = this.target.selectedSensorId || 0;\n        this.target.selectedSensorName = this.target.selectedSensorName || 'select a sensor';\n        this.target.selectedSensorDirty = this.target.selectedSensorDirty || false;\n        this.allSensors  = {};\n        // thing init start\n        this.target.selectedThingId = this.target.selectedThingId || 0;\n        this.target.selectedThingName = this.target.selectedThingName || 'select a thing';\n        this.target.selectedThingDirty = this.target.selectedThingDirty || false;\n        this.allThings  = {};\n        // location init start\n        this.target.selectedLocationId = this.target.selectedLocationId || 0;\n        this.target.selectedLocationName = this.target.selectedLocationName || 'select a location';\n        this.target.selectedLocationDirty = this.target.selectedLocationDirty || false;\n        this.allLocations = {};\n\n        this.panelCtrl.events.on('data-received', this.onDataReceived.bind(this), $scope);\n        this.panelCtrl.events.on('data-error', this.onDataError.bind(this), $scope);\n\n        this.target.jsonQuery = this.target.jsonQuery || '';\n        // appEvents.emit('alert-success', ['Test notification sent', '']);\n\n        if (this.target.selectedThingDirty) {\n            this.alertSrv.set('Thing Not Found', this.target.selectedThingId + ' is not a valid thing name', 'error', this.notificationShowTime);\n        }\n\n        if (this.target.selectedSensorDirty) {\n            this.alertSrv.set('Sensor Not Found', this.target.selectedSensorId + ' is not a valid sensor name', 'error', this.notificationShowTime);\n        }\n\n        if (this.target.selectedDatastreamDirty) {\n            this.alertSrv.set('Datastream Not Found', this.target.selectedDatastreamName + ' is not a valid datastream name', 'error', this.notificationShowTime);\n        }\n\n        if (this.target.selectedLocationDirty) {\n            this.alertSrv.set('Location Not Found', this.target.selectedLocationId + ' is not a valid location name', 'error', this.notificationShowTime);\n        }\n\n    }\n\n    onDataReceived(dataList) {\n        this.lastQueryError = null;\n    }\n\n    onDataError(err) {\n        this.handleQueryCtrlError(err);\n    }\n\n    handleQueryCtrlError(err) {\n        if (err.query && err.query.refId && err.query.refId !== this.target.refId) {\n            return;\n        }\n\n        if (err.error && err.error.data && err.error.data.error) {\n            this.lastQueryError = err.error.data.error.message;\n        } else if (err.error && err.error.data) {\n            this.lastQueryError = err.error.data.message;\n        } else if (err.data && err.data.error) {\n            this.lastQueryError = err.data.error.message;\n        } else if (err.data && err.data.message) {\n            this.lastQueryError = err.data.message;\n        } else {\n            this.lastQueryError = err;\n        }\n    }\n\n    toggleEditorMode() {\n        this.target.rawQuery = !this.target.rawQuery;\n    }\n\n\n    //sensor starts\n    showSensors(){\n        return this.target.type === 'Sensors';\n    }\n\n    jsonQueryClick(type) {\n        if(!this.isOmObservationType(type)){\n            this.alertSrv.set('Unsupported Observation Type', 'JSONPath only works when Datastream.observationType is OM_Observation' , 'warning', this.notificationShowTime);\n        }\n    }\n\n    getSensors(query) {\n        let self = this;\n        return this.datasource.metricFindQuery((query || ''),'/Sensors','sensor').then((result)=>{\n            self.allSensors = result;\n            return result;\n        }).catch(this.handleQueryCtrlError.bind(this));\n    }\n\n    onSensorChange(query,selectedSensorId) {\n        let sensor = _.find(this.allSensors, { 'value' : this.target.selectedSensorId });\n        console.log('find all sensors');\n\n        if(sensor) {\n            this.target.selectedSensorName = sensor.text;\n            this.target.selectedSensorDirty = false;\n        } else {\n            this.target.selectedSensorDirty = true;\n            this.target.selectedDatastreamId = 0;\n            this.alertSrv.set('Sensor Not Found', this.target.selectedSensorId + ' is not a valid sensor name', 'error', this.notificationShowTime);\n        }\n        this.resetDataSource();\n    }\n    //sensor ends\n\n    showThingOptions(){\n        return this.target.selectedThingId !== 0 && this.target.type === 'Things';\n    }\n\n    showThingLimit() {\n      //type = Target\n      //selectedThingOption = [Historical Locations|Historical Locations with Coordinates]\n      return this.target.type === this.queryTypes[1] && \n        this.target.selectedThingId !== 0 && \n        (this.target.selectedThingOption === this.queryThingOptions[1] || this.target.selectedThingOption === this.queryThingOptions[2])\n    }\n\n    //datastream starts\n    showDatastreams(){\n        return (this.target.type === 'Sensors' && this.target.selectedSensorId !== 0) ||\n            (this.target.type === 'Things' && this.target.selectedThingId !== 0 && this.target.selectedThingOption === 'Datastreams');\n    }\n// TODO: show errors below each query editor\n    getDataStreams(query) {\n        let self = this;\n        let targetUrl = '';\n        if (this.target.selectedThingDirty || this.target.selectedSensorDirty) {\n            return [{\n                text: 'select a datastream',\n                value: 0\n            }];\n        }\n        if (this.target.type === 'Sensors') {\n            targetUrl = '/Sensors('+this.getFormatedId(this.target.selectedSensorId)+')/Datastreams';\n        } else {\n            targetUrl = '/Things('+this.getFormatedId(this.target.selectedThingId)+')/Datastreams';\n        }\n        return this.datasource.metricFindQuery((query || ''),targetUrl,'datastream').then((result)=>{\n            self.allDataSources = result;\n            return result;\n        }).catch(this.handleQueryCtrlError.bind(this));\n    }\n\n    getFormatedId(id) {\n        return (Number.isInteger(id) || !isNaN(id)) ? id : '\"'+id+'\"';\n    }\n\n    onDataStreamChange(query) {\n        if (this.target.selectedThingDirty || this.target.selectedSensorDirty) {\n            return;\n        }\n\n        let datastream = _.find(this.allDataSources, { 'value' : this.target.selectedDatastreamId });\n\n        if(datastream) {\n            this.target.selectedDatastreamName = datastream.text;\n            this.target.selectedDatastreamObservationType = datastream.type.toLowerCase();\n            this.target.selectedDatastreamDirty = false;\n        } else {\n            this.target.selectedDatastreamDirty = true;\n            this.target.selectedDatastreamName = this.target.selectedDatastreamId;\n            this.target.selectedDatastreamObservationType = '';\n            this.alertSrv.set('Datastream Not Found', this.target.selectedDatastreamName + ' is not a valid datastream name', 'error', this.notificationShowTime);\n        }\n\n        if (this.isOmObservationType(this.target.selectedDatastreamObservationType)) {\n\n        } else {\n            this.panelCtrl.refresh();\n        }\n    }\n\n    onJsonQueryChange() {\n        this.panelCtrl.refresh();\n    }\n\n    showJsonQuery() {\n        return (this.target.selectedDatastreamId !== 0) &&\n                (this.target.type === 'Sensors' || \n                this.target.type === 'Things' && this.target.selectedThingOption === 'Datastreams') &&\n                this.isOmObservationType(this.target.selectedDatastreamObservationType);\n    }\n\n    isOmObservationType(type) {\n        if (_.isEmpty(type) || !type.includes('om_observation')) {\n            this.target.jsonQuery = '';\n            return false;\n        }\n        return true;\n    }\n\n    resetDataSource(){\n        this.target.selectedDatastreamId = 0;\n        this.target.selectedDatastreamName = 'select a datastream';\n        this.panelCtrl.refresh();\n    }\n    //datastream ends\n\n    typeChanged(type) {\n        this.target.selectedSensorId = 0;\n        this.target.selectedThingId = 0;\n        this.resetDataSource();\n    }\n\n    //thing starts\n    showThings(){\n        return this.target.type === 'Things' || this.target.type === 'Historical Locations';\n    }\n\n    getThings(query) {\n        let self = this;\n        return this.datasource.metricFindQuery((query || ''),'/Things','thing').then((result)=>{\n            self.allThings = result;\n            return result;\n        }).catch(this.handleQueryCtrlError.bind(this));\n    }\n\n    onThingChange(query) {\n\n        let thing = _.find(this.allThings, { 'value' : this.target.selectedThingId });\n        if(thing) {\n            this.target.selectedThingName = thing.text;\n            this.target.selectedThingDirty = false;\n        } else {\n            this.target.selectedThingDirty = true;\n            this.target.selectedDatastreamId = 0;\n            this.alertSrv.set('Thing Not Found', this.target.selectedThingId + ' is not a valid thing name', 'error', this.notificationShowTime);\n        }\n        this.resetDataSource();\n    }\n\n    onThingsLimitChange(query) {\n      this.panelCtrl.refresh();\n    }\n\n    onThingOptionChange(query){\n        this.panelCtrl.refresh();\n    }\n    //thing ends\n\n    //location starts\n    showLocations(){\n        return this.target.type === 'Locations';\n    }\n\n    getLocations(query) {\n        let self = this;\n        return this.datasource.metricFindQuery((query || ''),'/Locations','location').then((result)=>{\n            self.allLocations = result;\n            return result;\n        }).catch(this.handleQueryCtrlError.bind(this));\n    }\n\n    onLocationChange(query) {\n        // find and store the selected location name to use it as column name (refer datasource.js->transformThings())\n        let location = _.find(this.allLocations, { 'value' : this.target.selectedLocationId });\n\n        if (location) {\n            this.target.selectedLocationName = location.text;\n            this.target.selectedLocationDirty = false;\n        } else {\n            this.target.selectedLocationDirty = true;\n            this.alertSrv.set('Location Not Found', this.target.selectedLocationId + ' is not a valid location name', 'error', this.notificationShowTime);\n        }\n\n        this.panelCtrl.refresh();\n    }\n    //location ends\n\n}\n\nGenericDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n"]}